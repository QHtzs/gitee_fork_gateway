# 数据交换服务系统
## 结构
* `WEB` TCP服务端：端口号自己配置
* `APP` TCP服务端: 端口号自己配置
* `GATEWay` TCP服务端:端口号自己配置
* Redis服务，用于保存控制信息实时状态(目前只监控GATEWay服务与客户端tcp连接状况)
* http交互， 部分内容传输到其它服务。

## 大致通讯内容
### 接受连接时
* 检测序列号，若不合法，则断开连接。若服务端为GATEWay且序列号合法时，则把状态写入redis
* 获取序列号相同的3个tcp在分别WEB, APP,GATEWay三个服务的连接情况， 并发送到指定的http服务。
### 稳定连接时
* ALIVE为心跳内容
* 各个服务器与各自的客户端(大致1000个)进行长连接，接收到控制状态改变内容并转发到其它服务
* 转发结构 WEB-->GATEWay, APP-->GATEWay,  GATEWay-->{APP, WEB}
### 端开连接
* 若为若服务端为GATEWay，则把redis中相关的状态改为断开
* 断开连接

## GATEWay通讯中的加密解密
* 由于加密解密过程中，使用了base64，长度不为3的倍数时，粘包时可能会导解密失败
* 而通讯过程中，发现 '&nbsp;' (ascii码32)对数据解析过程不产生任何影响
* 针对上述情况，对于不为3的倍数的字符，加密前填充'&nbsp;'.
* 字符串比对时请去掉开头结尾的空白

## 实时数据监控
* 如客户端一样，连接到服务
* serial为 MONITOR_${tcpserial},其中${tcpserial}为被监控客户端serial
* 允许被挤，若之前monitor连接存在，需要先挤下之前连接，再重新连接
* 允许多个监听不同tcp客户端的monitor同时连接
